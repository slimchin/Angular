
@{
    ViewData["Title"] = "Index";
}

<!-- Begin Page Content -->
<div class="container-fluid">
    <div class="row" style="padding-top:10px">
        <div class="col-6 ">
            <h1 class="h3 mb-0 " style="color:#00235D">CUSTOMER CONSENT DATA </h1>
        </div>
        <div class="col-6 " style="text-align:right">
            <a href="@Url.Action("Create", "CustomerAcceptedConsents")" class="btn btn-info btn-icon-split" id="addnewlink">
                <span class="icon text-white-50">
                    <i class="fas fa-plus-circle"></i>
                </span>

                <span class="text" style="color:aliceblue">ADD NEW</span>
            </a>
        </div>
    </div>
    <hr />
    <div class="card mb-4">
        <div class="card-body">
            <form id="form1" method="post">
                <div class="row" style="padding-top:10px">
                    <div class="col-2" style="text-align:right">
                        <h5>เลขที่บัญชีลูกค้า</h5>
                    </div>
                    <div class="col-6">
                        <input name="accountNo" id="accountNo" class="form-control" placeholder="เลขที่บัญชีลูกค้า 5 หลัก" maxlength="5" style="width:400px" value="@ViewBag.accountNo">
                    </div>
                </div>
                <div class="row" style="padding-top:10px">
                    <div class="col-2" style="text-align:right">
                        <h5>Consent Form</h5>
                    </div>
                    <div class="col-6">
                        @Html.DropDownList("consentFormName", new SelectList(ViewBag.ConsentForm, "Value", "Text", "Value"), new { @class = "form-control", @Style = "width: 400px;" })
                    </div>
                </div>
                <div class="row" style="padding-top:10px">
                    <div class="col-2" style="text-align:right">
                        <h5>วันที่ทำรายการ</h5>
                    </div>
                    <div class="col-6">
                        <div class="row col-6">
                            <div >
                                <input type="text" class="form-control" id="TXTStartDate" name="TXTStartDate" value="@ViewBag.startdateSel" maxlength="10" size="10" >
                            </div>
                            <div >
                                <span> &nbsp;To&nbsp;</span>
                                
                            </div>
                            <div >
                                <input type="text" class="form-control" id="TXTEndDate" name="TXTEndDate" value="@ViewBag.enddateSel" maxlength="10" size="10">
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row" style="padding-top:10px">
                    <div class="col-2" style="text-align:right">
                    </div>
                    <div class="col-6">
                        <div class="row">
                            <div class="col-sm-2" style="padding-right:10px;text-align:left">
                                <a href="#" onclick="Search();"class="btn btn-primary btn-icon-split" id="addnewlink">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-search"></i>
                                    </span>

                                    <span class="text">&nbsp;Search&nbsp;</span>
                                </a>
                            </div>
                            <div class="col-sm-4">
                                <a href="#" onclick="Export();" class="btn btn-success btn-icon-split" id="addnewlink">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-file-excel"></i>
                                    </span>

                                    <span class="text">&nbsp; Export &nbsp;</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <div class="card shadow mb-4">

        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Result : @ViewBag.searchCondition</h6>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable1" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th width="120px" style="text-align:center">Trasaction Date</th>
                            <th width="90px" style="text-align:center">A/C No</th>
                            <th width="120px" style="text-align:center">REF No</th>
                            <th width="250px">Customer Name</th>
                            <th>Product</th>
                            <th>Consent Form Name</th>
                            <th width="150px" style="text-align:center">Status</th>
                            <th width="150px" style="text-align:center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            if (ViewBag.CustomerList != null)
                            {
                                foreach (var x in ViewBag.CustomerList)
                                {
                                    <tr id="@x.accountNo">
                                        <td style="text-align:center">@x.transactionDate.ToString("yyyy-MMM-dd HH:mm:ss")</td>
                                        <td style="text-align:center">@x.accountNo</td>
                                        <td style="text-align:center">@x.refNo</td>
                                        <td style="text-align:left">@x.customerName</td>
                                        <td style="text-align:center">@x.productName</td>
                                        <td style="text-align:left">@x.consentFormName</td>
                                        @if (x.status == "Full Accepted")
                                        {
                                            <td style="text-align:left"><b style="color:darkseagreen">All Accepted</b> </td>
                                        }
                                        else if (x.status == "Partial Accepted")
                                        {
                                            <td style="text-align:left"><b style="color:darkorange">@x.status</b></td>
                                        }
                                        else if (x.status == "Not Accepted")
                                        {
                                            <td style="text-align:left"><b style="color:red">@x.status</b></td>
                                        }
                                        <td style="text-align:center">
                                            <a href="#">
                                                <span class="align-text-top" onclick="ShowSummaryDetail('@x.accountNo');">View</span>
                                            </a>
                                            |
                                            <a href="#">
                                                <span class="align-text-top" style="color:orangered" onclick="Edit('@x.accountNo');">Edit</span>
                                            </a>
                                            |
                                            <a href="#">
                                                <span class="align-text-top" style="color:red" onclick="Delete('@x.accountNo','@x.productName');">Del</span>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<form id="form2" method="post">
    <input type="hidden" name="ACC" id="ACC" />
    <input type="hidden" name="PROD" id="PROD" />
</form>


<div id="AcceptedDetailPartial">
    @{Html.RenderPartial("AcceptedDetailPartial", null);}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#dataTable1').DataTable({
            "order": [[0, "desc"]]
        });
    });

    function ShowSummaryDetail(accountNo) {
        if (accountNo == '' || accountNo == null) {
            alert('Error invalid AccountNo number.');
            return false;
        }
        $.post('AcceptedDetailPartial', { accountNo: accountNo }, function (data) {
            $("#AcceptedDetailPartial").html(data);
            $('#AcceptedDetailModal').modal('show');
        });
    }
    $(function () {
        $("#datepicker").datepicker({
            format: 'dd/mm/yyyy',
            autoclose: true,

        });
    });
    function Edit(accountNo) {
        if (accountNo == '' || accountNo == null) {
            alert('Error invalid AccountNo number.');
            return false;
        }
        $('#ACC').val(accountNo);
        $('#form2').attr('action', 'Edit');
        $('#form2').submit();
    }
    function Search() {
        $('#form1').attr('action', 'Search');
        $('#form1').submit();
    }
    function Export() {
        $('#form1').attr('action', 'Export');
        $('#form1').submit();
    }

    function Delete(accountNo, productName) {
        $('#ACC').val(accountNo);
        $('#PROD').val(productName);
        $('#form2').attr('action', 'Delete');
        $('#form2').submit();
    }



</script>